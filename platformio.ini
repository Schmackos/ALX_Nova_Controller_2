; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = esp32-s3-devkitm-1

[env:esp32-s3-devkitm-1]
platform = espressif32
board = esp32-s3-devkitm-1
framework = arduino

; ===== LittleFS Configuration =====
board_build.filesystem = littlefs

; ===== Pin Configuration (can be overridden per-environment) =====
build_flags =
    -D LED_PIN=2
    -D RESET_BUTTON_PIN=15
    -D AMPLIFIER_PIN=4
    -D BUZZER_PIN=8
    -D I2S_BCK_PIN=16
    -D I2S_DOUT_PIN=17
    -D I2S_DOUT2_PIN=9
    -D I2S_LRC_PIN=18
    -D I2S_MCLK_PIN=3
    -D CORE_DEBUG_LEVEL=2
    -D CONFIG_ARDUHAL_LOG_COLORS=1
    -Os
    ; ===== GUI (TFT + Encoder) =====
    -D GUI_ENABLED
    -D LV_CONF_INCLUDE_SIMPLE
    -I src/gui
    -D USER_SETUP_LOADED
    -D USER_SETUP_ID=0
    -include src/gui/User_Setup.h

; ===== Library Dependencies =====
lib_deps =
	links2004/WebSockets@^2.7.2
	bblanchon/ArduinoJson@^7.4.2
	knolleary/PubSubClient@^2.8
	lvgl/lvgl@^9.2.0
	bodmer/TFT_eSPI@^2.5.43
	kosme/arduinoFFT@^2.0

; ===== Serial Monitor =====
monitor_speed = 9600
;monitor_filters= direct, esp32_exception_decoder

; ===== Upload Settings =====
; upload_speed = 921600

; ===== Partition Table (optional - use if needing more space) =====
; board_build.partitions = huge_app.csv

; ===== Test Configuration =====
; Ignore all unit tests for ESP32 (tests are designed for native environment)
test_ignore = *

; ===== Wokwi Simulation Environment =====
; Uses ILI9341 driver (Wokwi built-in) instead of ST7735S
; Build: pio run -e esp32-s3-wokwi
[env:esp32-s3-wokwi]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
board_build.filesystem = littlefs
board_build.flash_mode = dio
build_flags =
    -D LED_PIN=38
    -D RESET_BUTTON_PIN=9
    -D AMPLIFIER_PIN=39
    -D BUZZER_PIN=8
    -D I2S_BCK_PIN=16
    -D I2S_DOUT_PIN=17
    -D I2S_DOUT2_PIN=19
    -D I2S_LRC_PIN=18
    -D I2S_MCLK_PIN=3
    -D CORE_DEBUG_LEVEL=2
    -D CONFIG_ARDUHAL_LOG_COLORS=1
    -Os
    ; ===== Wokwi compatibility: use UART serial (not USB CDC) =====
    -D ARDUINO_USB_MODE=0
    -D ARDUINO_USB_CDC_ON_BOOT=0
    ; ===== GUI (TFT + Encoder) â€” Wokwi ILI9341 =====
    -D GUI_ENABLED
    -D LV_CONF_INCLUDE_SIMPLE
    -I src/gui
    -D USER_SETUP_LOADED
    -D USER_SETUP_ID=0
    -include src/gui/User_Setup_Wokwi.h
lib_deps =
    links2004/WebSockets@^2.7.2
    bblanchon/ArduinoJson@^7.4.2
    knolleary/PubSubClient@^2.8
    lvgl/lvgl@^9.2.0
    bodmer/TFT_eSPI@^2.5.43
    kosme/arduinoFFT@^2.0
monitor_speed = 9600
test_ignore = *

; ===== Native Testing Environment =====
[env:native]
platform = native
test_framework = unity
build_flags =
    -std=c++11
    -D UNIT_TEST
    -D NATIVE_TEST
lib_deps =
	bblanchon/ArduinoJson@^7.4.2
	kosme/arduinoFFT@^2.0
lib_compat_mode = off
test_ignore = test_mocks
test_build_src = no